<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>æƒ…ç»ªåœ°å›¾ Â· æƒ³è§ä½ </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
  <style>
    body { margin: 0; padding: 0; background: #000; overflow: hidden; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    .heartbeat {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      opacity: 0.5;
      transform: translate(-50%, -50%) scale(1);
      animation: pulse 0.6s ease-out forwards;
      pointer-events: none;
      z-index: 999;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.5; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.3; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
    }
  </style>
</head>
<body>
<div id="map"></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoieGpuMjAyNSIsImEiOiJjbTkxMWJ1cTEwM3NkMm5wdnNkemE4Z24yIn0.ZDf4-d0toG_wjYNsdQvlzw';
const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/dark-v10',
  center: [144.9631, -37.8136],
  zoom: 12
});

map.on('load', () => {
  map.addSource('posts', {
    type: 'geojson',
    data: './data.geojson'
  });

  // ğŸŒŸ å‘¼å¸æ„Ÿ Glow å…‰åœˆï¼ˆåˆå§‹ï¼‰
  map.addLayer({
    id: 'posts-glow',
    type: 'circle',
    source: 'posts',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        10, 20,
        14, 45
      ],
      'circle-color': [
        'match',
        ['get', 'type'],
        'å¿ƒæ„¿', '#66ccff',
        'æ‰¾äºº', '#ffdd33',
        '#cccccc'
      ],
      'circle-opacity': 0.2,
      'circle-blur': 0.8
    }
  });

  // ğŸ“ ç‚¹å‡»è¯†åˆ«å±‚ï¼ˆé€æ˜ä½†æ‰©å¤§ç‚¹å‡»èŒƒå›´ï¼‰
  map.addLayer({
    id: 'posts-clickable',
    type: 'circle',
    source: 'posts',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        10, 15,
        14, 30
      ],
      'circle-color': '#000000',
      'circle-opacity': 0
    }
  });

  // ğŸ“ ä¸»ç‚¹ï¼ˆæ°”æ³¡æœ¬ä½“ï¼‰
  map.addLayer({
    id: 'posts-main',
    type: 'circle',
    source: 'posts',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        10, 6,
        14, 10
      ],
      'circle-color': [
        'match',
        ['get', 'type'],
        'å¿ƒæ„¿', '#66ccff',
        'æ‰¾äºº', '#ffdd33',
        '#ffffff'
      ],
      'circle-opacity': 0.95,
      'circle-blur': 0.1
    }
  });

  // ğŸ«§ åç§»é«˜å…‰å±‚ï¼ˆæ¨¡æ‹Ÿâ€œä¾§é¢ç å…‰æ„Ÿâ€ï¼‰
  map.addLayer({
    id: 'posts-highlight',
    type: 'circle',
    source: 'posts',
    paint: {
      'circle-radius': [
        'interpolate', ['linear'], ['zoom'],
        10, 2,
        14, 4
      ],
      'circle-color': '#ffffff',
      'circle-opacity': 0.3,
      'circle-translate': [1.2, -1.2]
    }
  });

  // ğŸ’“ ç‚¹å‡»å¿ƒè·³åŠ¨ç”»
  map.on('click', 'posts-clickable', (e) => {
    const props = e.features[0].properties;
    const center = map.project(e.lngLat);
    const type = props.type;

    const heart = document.createElement('div');
    heart.className = 'heartbeat';
    heart.style.left = `${center.x}px`;
    heart.style.top = `${center.y}px`;
    heart.style.background = type === 'å¿ƒæ„¿' ? '#66ccff55' : '#ffdd3355';
    document.body.appendChild(heart);
    setTimeout(() => heart.remove(), 600);

    new mapboxgl.Popup()
      .setLngLat(e.lngLat)
      .setHTML(`<strong>${props.title}</strong><br>${props.content}`)
      .addTo(map);
  });

  map.on('mouseenter', 'posts-clickable', () => {
    map.getCanvas().style.cursor = 'pointer';
  });
  map.on('mouseleave', 'posts-clickable', () => {
    map.getCanvas().style.cursor = '';
  });

  // ğŸŒ¬ å‘¼å¸åŠ¨ç”»é€»è¾‘ï¼šå¾ªç¯è°ƒæ•´ glow é€æ˜åº¦
  let fading = true;
  setInterval(() => {
    const opacity = fading ? 0.08 : 0.2;
    map.setPaintProperty('posts-glow', 'circle-opacity', opacity);
    fading = !fading;
  }, 2000);
});
</script>
</body>
</html>
